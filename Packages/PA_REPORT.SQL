--------------------------------------------------------
--  File created - Thursday-February-15-2018   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Package PA_REPORT
--------------------------------------------------------

  CREATE OR REPLACE PACKAGE "VB"."PA_REPORT" 
AS
  
  PROCEDURE S_REPORT(
      nSTUD_ID   IN REPORT.STUD_ID%TYPE,
      nSUB_ID  IN TEST.SUB_ID%TYPE,
      DATA_REC OUT SYS_REFCURSOR,
      nRETURNCODE OUT NUMBER);
      
   PROCEDURE S_MYREPORT(
      nSTUD_ID   IN REPORT.STUD_ID%TYPE,
      DATA_REC OUT SYS_REFCURSOR,
      nRETURNCODE OUT NUMBER);
  
END PA_REPORT;

/


create or replace PACKAGE BODY PA_REPORT AS PROCEDURE S_REPORT( nSTUD_ID IN REPORT.STUD_ID%TYPE, nSUB_ID IN TEST.SUB_ID%TYPE, DATA_REC OUT SYS_REFCURSOR, nRETURNCODE OUT NUMBER) AS BEGIN nRETURNCODE := 0; BEGIN OPEN DATA_REC FOR SELECT R.STUD_ID,S.NAME,SB.SUB_NAME,T.CLASS_ID,T.TEST_NUM,T.TOT_MKS,R.MARKS_OBT FROM TEST T,REPORT R,STUDENT S,SUBJECT SB WHERE T.TEST_ID = R.TEST_ID AND R.STUD_ID = nSTUD_ID AND T.CLASS_ID IN (SELECT CLASS_ID FROM TEST WHERE SUB_ID = nSUB_ID ) AND S.STUD_ID = nSTUD_ID AND SB.SUB_ID = nSUB_ID; EXCEPTION WHEN OTHERS THEN nRETURNCODE := -21; END; END S_REPORT; PROCEDURE S_MYREPORT( nSTUD_ID IN REPORT.STUD_ID%TYPE, DATA_REC OUT SYS_REFCURSOR, nRETURNCODE OUT NUMBER) AS BEGIN nRETURNCODE := 0; BEGIN OPEN DATA_REC FOR SELECT S.STUD_ID,S.NAME,SB.SUB_NAME,T.TEST_NUM,T.TOT_MKS,R.MARKS_OBT FROM STUDENT S, REPORT R, TEST T,SUBJECT SB WHERE R.STUD_ID = nSTUD_ID AND R.TEST_ID = T.TEST_ID AND T.SUB_ID = SB.SUB_ID AND S.STUD_ID = nSTUD_ID; EXCEPTION WHEN OTHERS THEN nRETURNCODE := -21; END; END S_MYREPORT; END PA_REPORT;/

create or replace PACKAGE BODY PA_STUDENT AS PROCEDURE S_STUDENT( nID IN STUDENT.STUD_ID%TYPE, sNAME IN STUDENT.NAME%TYPE, nCLASS IN STUDENT.CLASS_ID%TYPE, STUD_REC OUT SYS_REFCURSOR) AS BEGIN BEGIN OPEN STUD_REC FOR SELECT STUD_ID , NAME , CLASS_ID , PARENTS_CONTACT_NO, ADDRESS FROM STUDENT WHERE (nID IS NULL OR nID=0 OR nID=STUD_ID) AND (sName IS NULL OR NAME LIKE '%' || sName ||'%') AND (nClass IS NULL OR nClass=0 OR nClass=CLASS_ID); END; END S_STUDENT; PROCEDURE GET_STUDENT_ROLL( nUSER_ID IN STUDENT.USER_ID%TYPE, STUD_REC OUT SYS_REFCURSOR, nRETURNCODE OUT NUMBER) AS BEGIN nRETURNCODE:=0; BEGIN OPEN STUD_REC FOR SELECT STUD_ID , NAME , USER_ID FROM STUDENT WHERE (nUSER_ID = USER_ID); END; EXCEPTION WHEN OTHERS THEN nRETURNCODE:=-21; END GET_STUDENT_ROLL; PROCEDURE GET_STUDENT_FROM_SCHOOL( nCLASS_ID IN STUDENT.CLASS_ID%TYPE, STUD_REC OUT SYS_REFCURSOR, nRETURNCODE OUT NUMBER) AS BEGIN nRETURNCODE := 0; BEGIN IF (nCLASS_ID = 0) THEN BEGIN OPEN STUD_REC FOR SELECT STUD_ID FROM STUDENT; END; ELSE BEGIN OPEN STUD_REC FOR SELECT STUD_ID FROM STUDENT WHERE nCLASS_ID = CLASS_ID; END; END IF; EXCEPTION WHEN OTHERS THEN nRETURNCODE := -23; END; END GET_STUDENT_FROM_SCHOOL; END PA_STUDENT;/